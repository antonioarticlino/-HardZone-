<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Loja • Mobile</title>
<style>
  :root{
    --bg:#0f1220; --bg2:#0a0e1c; --card:#11162a; --line:#1f2643;
    --text:#f7f8ff; --muted:#9aa3c1; --price:#6ee7b7; --btn:#34d399;
    --badge:#f59e0b; --ring:rgba(110,231,183,.35);
  }
  *{box-sizing:border-box}
  body{margin:0;background:linear-gradient(180deg,var(--bg),var(--bg2));color:var(--text);
       font:500 15px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial}
  .wrap{max-width:980px;margin:18px auto;padding:0 14px}

  header{display:flex;align-items:center;justify-content:center;margin-bottom:6px}
  header h1{font-size:22px;margin:6px 0 2px}
  header p{margin:0;color:var(--muted);font-size:13px;text-align:center}

  /* busca */
  .search{position:relative;margin:10px 0 8px}
  .search input{
    width:100%; background:#0d1226; color:var(--text); border:1px solid var(--line);
    border-radius:999px; padding:12px 44px 12px 40px; outline:none; transition:.2s;
    box-shadow:0 0 0 0 var(--ring);
  }
  .search input:focus{box-shadow:0 0 0 6px var(--ring); border-color:transparent}
  .search svg{position:absolute;left:12px;top:50%;transform:translateY(-50%);opacity:.8}
  .clear{position:absolute;right:8px;top:50%;transform:translateY(-50%);
    background:transparent;border:0;color:var(--muted);font-size:18px;padding:6px 10px;cursor:pointer}

  /* ====== LAYOUT ESTILO MARKETPLACE ====== */
  .grid{
    display:grid;
    grid-template-columns:repeat(2,1fr);
    gap:10px;
    padding-bottom:12px;
  }
  @media (min-width:720px){
    .grid{grid-template-columns:repeat(3,1fr)}
  }
  @media (min-width:960px){
    .grid{grid-template-columns:repeat(4,1fr)}
  }

  .tile{
    background:var(--card);
    border:1px solid var(--line);
    border-radius:12px;
    overflow:hidden;
    box-shadow:0 10px 24px rgba(0,0,0,.25);
    display:flex; flex-direction:column;
  }
  .tile .thumb{
    position:relative;
    aspect-ratio:1/1;
    background:#0b0f24;
  }
  .tile .thumb img{
    width:100%; height:100%; object-fit:cover; display:block; cursor:zoom-in;
  }
  .tile .badge{
    position:absolute;left:8px;top:8px;background:var(--badge);color:#2b1700;
    font-size:12px;font-weight:900;padding:4px 8px;border-radius:999px
  }
  .tile .body{padding:10px}

  /* ✅ títulos/frases completas (sem cortar) */
  .line{
    display:block;
    white-space:normal;      /* antes: nowrap */
    overflow:visible;        /* antes: hidden  */
    text-overflow:unset;     /* antes: ellipsis */
    font-weight:800; font-size:14px; line-height:1.3;
  }

  .price{color:var(--price); font-weight:900}
  .sep{color:#8aa0ff33; margin:0 6px}
  .muted{color:var(--muted); font-size:12px}

  /* permite quebra de linha dos botões quando o texto é grande */
  .actions{display:flex; gap:8px; margin-top:8px; align-items:stretch; flex-wrap:wrap}

  /* ✅ botões menores e com quebra de linha */
  .btn{
    flex:1;
    display:inline-flex;
    align-items:center;
    justify-content:center;
    padding:6px 8px;             /* antes: 10px 12px */
    border-radius:8px;            /* antes: 10px */
    border:1px solid transparent;
    background:var(--btn);
    color:#052015;
    font-weight:700;              /* antes: 900 */
    font-size:13px;               /* texto um pouco menor */
    line-height:1.2;
    white-space:normal;           /* permite quebrar */
    text-align:center;
    cursor:pointer;
    text-decoration:none;
  }
  .btn.ghost{background:transparent;border-color:#2a315f;color:var(--text)}

  .empty{color:var(--muted);text-align:center;margin:18px 0}

  /* barra de checkout */
  .bar{position:sticky;bottom:0;left:0;right:0;background:rgba(10,14,28,.9);backdrop-filter:blur(6px);
       border-top:1px solid var(--line);padding:10px 14px;display:flex;gap:12px;align-items:center;justify-content:space-between;flex-wrap:wrap}
  .bar .sum{font-weight:800}
  .bar .left{display:flex;flex-direction:column;gap:6px}

  /* pagamento */
  .pay{display:flex;gap:6px;flex-wrap:wrap}
  .pill{position:relative}
  .pill input{position:absolute;opacity:0;pointer-events:none}
  .pill span{
    display:inline-block;padding:6px 10px;border-radius:999px;border:1px solid #2a315f;
    background:transparent;color:var(--text);font-weight:800;cursor:pointer;font-size:13px
  }
  .pill input:checked + span{background:var(--btn);color:#052015;border-color:transparent}

  /* BOTÃO ADM */
  .adm-btn{
    position:fixed; right:14px; bottom:16px; z-index:1000;
    width:48px; height:48px; border-radius:999px;
    border:1px solid #2a315f;
    background:linear-gradient(90deg,var(--price),var(--btn));
    color:#052015; font-weight:900; letter-spacing:.5px;
    box-shadow:0 10px 30px rgba(0,0,0,.35);
    cursor:pointer;
  }

  /* ===== VIEWER (lightbox) ===== */
  .viewer{position:fixed; inset:0; background:rgba(0,0,0,.85); display:none;
          align-items:center; justify-content:center; z-index:9999;}
  .viewer.show{display:flex}
  .viewer img{max-width:96vw; max-height:86vh; border-radius:12px; box-shadow:0 20px 50px rgba(0,0,0,.5); cursor:zoom-out}
  .vclose,.vprev,.vnext{
    position:absolute; width:44px; height:44px; border-radius:999px; border:1px solid #ffffff33;
    background:#0008; color:#fff; display:flex; align-items:center; justify-content:center;
    font-size:22px; cursor:pointer; user-select:none
  }
  .vclose{top:14px; right:14px}
  .vprev{left:16px; top:50%; transform:translateY(-50%)}
  .vnext{right:16px; top:50%; transform:translateY(-50%)}
  .vcount{position:absolute; bottom:14px; left:50%; transform:translateX(-50%);
          background:#0009; color:#fff; padding:4px 10px; border-radius:999px; font-weight:700; font-size:12px}

  /* ===== SACOLA (drawer) ===== */
  .cart{position:fixed; inset:0; display:none; z-index:9998; background:rgba(0,0,0,.55); backdrop-filter:blur(4px)}
  .cart.show{display:block}
  .cart-panel{position:absolute; right:0; top:0; bottom:0; width:min(520px,92vw);
    background:var(--card); border-left:1px solid var(--line); box-shadow:-10px 0 30px rgba(0,0,0,.35);
    display:flex; flex-direction:column}
  .cart-head{display:flex; align-items:center; justify-content:space-between; padding:14px 16px; border-bottom:1px solid var(--line); font-weight:900; letter-spacing:.3px}
  .cart-close{background:transparent; border:0; color:var(--muted); font-size:22px; cursor:pointer}
  .cart-body{padding:10px 12px; overflow-y:auto; gap:10px; display:flex; flex-direction:column}
  .cart-empty{color:var(--muted); text-align:center; padding:24px 8px}
  .cart-item{display:grid; grid-template-columns:64px 1fr auto; gap:10px; align-items:center; border:1px solid var(--line); border-radius:12px; padding:8px; background:#0e1330}
  .cart-item img{width:64px; height:64px; object-fit:cover; border-radius:8px}
  .cart-title{font-weight:800; font-size:14px; margin:0 0 4px 0}
  .cart-price{color:var(--price); font-weight:900; font-size:14px}
  .qty{display:inline-flex; align-items:center; gap:8px; border:1px solid var(--line); border-radius:10px; padding:4px 6px}
  .qty button{background:transparent; border:0; color:var(--text); font-weight:900; cursor:pointer; width:22px; height:22px}
  .remove{background:transparent; border:0; color:#ff9a9a; cursor:pointer; font-weight:900}
  .cart-foot{margin-top:auto; border-top:1px solid var(--line); padding:12px 14px; display:flex; align-items:center; justify-content:space-between; gap:10px; flex-wrap:wrap}
  .cart-total{font-weight:900}
  .cart-btn{padding:10px 14px; border-radius:12px; border:1px solid transparent; background:var(--btn); color:#052015; font-weight:900; cursor:pointer}

  /* ===== MODAL DE DESCRIÇÃO ===== */
  .modal{position:fixed; inset:0; display:none; z-index:9998; background:rgba(0,0,0,.65); backdrop-filter:blur(4px)}
  .modal.show{display:flex; align-items:center; justify-content:center}
  .modal-card{
    width:min(680px,92vw); max-height:86vh; overflow:auto;
    background:var(--card); border:1px solid var(--line); border-radius:14px; padding:14px;
    box-shadow:0 20px 50px rgba(0,0,0,.45)
  }
  .modal-head{display:flex; justify-content:space-between; align-items:center; gap:8px; margin-bottom:8px}
  .modal-head h4{margin:0; font-size:16px}
  .modal-close{background:transparent; border:0; color:var(--muted); font-size:22px; cursor:pointer}
  .modal-body{color:var(--muted); font-size:14px; white-space:pre-wrap}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1 id="nomeLoja">HardZone</h1>
        <p></p>
      </div>
    </header>

    <!-- dados -->
    <script src="produtos.js"></script>

    <!-- busca -->
    <div class="search" role="search" aria-label="buscar produtos">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true">
        <path d="M21 21l-4.2-4.2M10.5 18a7.5 7.5 0 1 1 0-15 7.5 7.5 0 0 1 0 15z" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      </svg>
      <input id="q" type="search" placeholder="Buscar produtos..." autocomplete="off" />
      <button id="clear" class="clear" title="Limpar" aria-label="limpar busca">×</button>
    </div>

    <!-- grade estilo marketplace -->
    <section>
      <div id="grid" class="grid" aria-label="lista de produtos"></div>
      <div id="empty" class="empty" style="display:none">Nenhum item encontrado.</div>
    </section>

    <!-- barra de checkout -->
    <div class="bar" id="bar" style="display:none">
      <div class="left">
        <div><span id="qtd">0</span> item(ns) • <span id="total" class="sum">R$ 0,00</span></div>
        <div class="pay" role="radiogroup" aria-label="Forma de pagamento">
          <label class="pill"><input type="radio" name="pg" value="PIX" checked><span>PIX</span></label>
          <label class="pill"><input type="radio" name="pg" value="Cartão"><span>Cartão</span></label>
          <label class="pill"><input type="radio" name="pg" value="Dinheiro"><span>Dinheiro</span></label>
        </div>
      </div>
      <div style="display:flex; gap:8px">
        <button id="abrirSacola" class="btn ghost">ver descrição do produto</button>
        <button id="finalizar" class="btn">finalizar no WhatsApp</button>
      </div>
    </div>
  </div>

  <!-- Botão flutuante ADM -->
  <button id="btnAdm" class="adm-btn" title="Área do administrador" aria-label="Área do administrador">ADM</button>

  <!-- Viewer (lightbox) -->
  <div id="viewer" class="viewer" role="dialog" aria-modal="true" aria-label="Visualizador de imagens">
    <button id="vClose" class="vclose" title="Fechar" aria-label="Fechar">×</button>
    <button id="vPrev"  class="vprev"  title="Anterior" aria-label="Anterior">‹</button>
    <img id="vImg" alt="Imagem do produto">
    <button id="vNext"  class="vnext"  title="Próxima" aria-label="Próxima">›</button>
    <div id="vCount" class="vcount"></div>
  </div>

  <!-- Sacola (drawer) -->
  <div id="cart" class="cart" role="dialog" aria-modal="true" aria-label="Sacola">
    <div class="cart-panel">
      <div class="cart-head">
        <span>Sacola</span>
        <button id="cartClose" class="cart-close" title="Fechar">×</button>
      </div>
      <div id="cartBody" class="cart-body">
        <div class="cart-empty">Sua sacola está vazia.</div>
      </div>
      <div class="cart-foot">
        <div class="cart-total">Total: <span id="cartTotal">R$ 0,00</span></div>
        <div style="display:flex; gap:8px; align-items:center">
          <button id="cartClear" class="remove" title="Esvaziar sacola">esvaziar</button>
          <button id="cartCheckout" class="cart-btn">finalizar no WhatsApp</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal de Descrição -->
  <div id="descModal" class="modal" role="dialog" aria-modal="true" aria-label="Descrição do produto">
    <div class="modal-card">
      <div class="modal-head">
        <h4 id="descTitle">Produto</h4>
        <button id="descClose" class="modal-close" title="Fechar">×</button>
      </div>
      <div id="descBody" class="modal-body"></div>
      <div class="actions" style="margin-top:12px">
        <button id="descAdd" class="btn">adicionar à sacola</button>
        <button id="descWa" class="btn ghost">chamar no WhatsApp</button>
      </div>
    </div>
  </div>

<script>
  /* ===== Config ===== */
  const NOME_LOJA = 'HardZone';
  const numeroWA  = '559284977208';

  document.getElementById('nomeLoja').textContent = NOME_LOJA;

  // fallback para teste
  if (!Array.isArray(window.PRODUTOS)) {
    window.PRODUTOS = [{
      titulo:'Produto de Teste',
      preco:79.9,
      categoria:'Categoria',
      descricao:'Descrição de exemplo.',
      fotos:['data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=']
    }];
  }
  const produtosAll = window.PRODUTOS;

  /* ===== Estado ===== */
  let query = '';
  let carrinho = [];
  let formaPagamento = 'PIX';
  let lastOpenedProd = null;

  /* ===== Util ===== */
  const fmt = new Intl.NumberFormat('pt-BR', { style:'currency', currency:'BRL' });
  const $ = s => document.querySelector(s);
  const escapeHTML = (s='') => s.replace(/[&<>"']/g,m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[m]));
  const norm = s => (s||'').toString().normalize('NFD').replace(/[\u0300-\u036f]/g,'').toLowerCase();

  /* ===== Busca ===== */
  const q = $('#q'), clearBtn = $('#clear');
  function onSearchInput(){ query = norm(q.value.trim()); renderGrid(); }
  q.addEventListener('input', onSearchInput);
  clearBtn.onclick = () => { q.value=''; query=''; renderGrid(); };

  /* ===== Filtro ===== */
  function filtrados(){
    const qn = query;
    if (!qn) return produtosAll.slice();
    return produtosAll.filter(p=>{
      const hay = norm(`${p.titulo||''} ${p.categoria||''} ${p.descricao||''} ${(p.tags||[]).join(' ')}`);
      return hay.includes(qn);
    });
  }

  /* ===== VIEWER ===== */
  const viewer  = $('#viewer');
  const vImg    = $('#vImg');
  const vPrev   = $('#vPrev');
  const vNext   = $('#vNext');
  const vClose  = $('#vClose');
  const vCount  = $('#vCount');
  let vSources = [], vIdx = 0;

  function vShow(i){
    if (!vSources.length) return;
    vIdx = (i + vSources.length) % vSources.length;
    vImg.src = vSources[vIdx];
    vCount.textContent = vSources.length > 1 ? `${vIdx+1}/${vSources.length}` : '';
    const many = vSources.length > 1;
    vPrev.style.display = many ? 'flex' : 'none';
    vNext.style.display = many ? 'flex' : 'none';
  }
  function openViewer(srcs, start=0){
    vSources = Array.isArray(srcs) && srcs.length ? srcs.slice() : [];
    vShow(start);
    viewer.classList.add('show');
    document.body.style.overflow = 'hidden';
  }
  function closeViewer(){
    viewer.classList.remove('show');
    document.body.style.overflow = '';
  }
  vClose.addEventListener('click', closeViewer);
  vPrev.addEventListener('click', () => vShow(vIdx-1));
  vNext.addEventListener('click', () => vShow(vIdx+1));
  viewer.addEventListener('click', (e)=>{ if(e.target === viewer) closeViewer(); });

  /* ===== Render ===== */
  const grid = $('#grid'), empty = $('#empty');

  function renderGrid(){
    const lista = filtrados();
    grid.innerHTML = '';
    empty.style.display = lista.length ? 'none' : 'block';

    lista.forEach((p, i) => {
      const fotos = Array.isArray(p.fotos) ? p.fotos : [];
      const foto0 = fotos[0] || '';
      const preco = fmt.format(Number(p.preco||0));

      const el = document.createElement('article');
      el.className = 'tile';
      el.innerHTML = `
        <div class="thumb">
          ${p.selo ? `<span class="badge">${escapeHTML(p.selo)}</span>` : ''}
          <img loading="lazy" src="${foto0}" alt="${escapeHTML(p.titulo||'Produto')}">
        </div>
        <div class="body">
          <span class="line"><span class="price">${preco}</span><span class="sep"> · </span>${escapeHTML(p.titulo||'Produto')}</span>
          ${p.categoria ? `<div class="muted">${escapeHTML(p.categoria)}</div>` : ''}
          <div class="actions">
            <button class="btn ghost" data-desc="${i}">ver descrição do produto</button>
            <button class="btn" data-add="${i}">adicionar</button>
          </div>
        </div>
      `;
      grid.appendChild(el);

      // eventos
      const imgEl = el.querySelector('img');
      imgEl.addEventListener('click', ()=> openViewer(fotos.length?fotos:[foto0], 0));
    });

    // botões
    grid.querySelectorAll('[data-add]').forEach(btn=>{
      btn.onclick = () => addCarrinho(filtrados()[btn.dataset.add]);
    });
    grid.querySelectorAll('[data-desc]').forEach(btn=>{
      btn.onclick = () => openDesc(filtrados()[btn.dataset.desc]);
    });
  }

  /* ===== Carrinho / Sacola ===== */
  const bar = $('#bar'), qtdEl = $('#qtd'), totalEl = $('#total');
  const cart = $('#cart'), cartBody = $('#cartBody'), cartTotal = $('#cartTotal');

  document.querySelectorAll('input[name="pg"]').forEach(inp=>{
    inp.addEventListener('change', ()=>{ if(inp.checked) formaPagamento = inp.value; });
  });

  function addCarrinho(p){
    const id = p.id || p.titulo;
    const found = carrinho.find(i=>i.id===id);
    if(found) found.qtd += 1;
    else carrinho.push({id, titulo:p.titulo, preco:Number(p.preco||0), qtd:1, foto:(Array.isArray(p.fotos)&&p.fotos[0])||''});
    renderBar(); renderCart();
  }

  function inc(id){ const it = carrinho.find(i=>i.id===id); if(!it) return; it.qtd++; renderBar(); renderCart(); }
  function dec(id){
    const it = carrinho.find(i=>i.id===id); if(!it) return;
    it.qtd--; if(it.qtd<=0) carrinho = carrinho.filter(i=>i.id!==id);
    renderBar(); renderCart();
  }
  function removeItem(id){ carrinho = carrinho.filter(i=>i.id!==id); renderBar(); renderCart(); }
  function clearCart(){ carrinho = []; renderBar(); renderCart(); }

  function renderBar(){
    const qtd = carrinho.reduce((s,i)=>s+i.qtd,0);
    const total = carrinho.reduce((s,i)=>s+i.preco*i.qtd,0);
    qtdEl.textContent = qtd;
    totalEl.textContent = fmt.format(total);
    bar.style.display = qtd ? 'flex' : 'none';
  }

  function renderCart(){
    cartBody.innerHTML = '';
    if (!carrinho.length) {
      cartBody.innerHTML = '<div class="cart-empty">Sua sacola está vazia.</div>';
    } else {
      carrinho.forEach(it=>{
        const li = document.createElement('div');
        li.className = 'cart-item';
        li.innerHTML = `
          <img src="${it.foto||''}" alt="${escapeHTML(it.titulo)}">
          <div>
            <div class="cart-title">${escapeHTML(it.titulo)}</div>
            <div class="cart-price">${fmt.format(it.preco)}</div>
          </div>
          <div class="cart-actions">
            <div class="qty">
              <button aria-label="diminuir" data-act="dec" data-id="${it.id}">−</button>
              <strong>${it.qtd}</strong>
              <button aria-label="aumentar" data-act="inc" data-id="${it.id}">+</button>
            </div>
            <button class="remove" data-act="rem" data-id="${it.id}" title="remover">remover</button>
          </div>
        `;
        cartBody.appendChild(li);
      });
    }
    const total = carrinho.reduce((s,i)=>s+i.preco*i.qtd,0);
    cartTotal.textContent = fmt.format(total);

    cartBody.querySelectorAll('[data-act]').forEach(b=>{
      b.onclick = () => {
        const id = b.getAttribute('data-id');
        const act = b.getAttribute('data-act');
        if (act==='inc') inc(id);
        if (act==='dec') dec(id);
        if (act==='rem') removeItem(id);
      };
    });
  }

  function openCart(){ cart.classList.add('show'); document.body.style.overflow='hidden'; }
  function closeCart(){ cart.classList.remove('show'); document.body.style.overflow=''; }
  $('#abrirSacola').onclick = openCart;
  $('#cartClose').onclick = closeCart;
  cart.addEventListener('click', (e)=>{ if(e.target===cart) closeCart(); });
  $('#cartClear').onclick = clearCart;

  function checkout(){
    if (!carrinho.length) return;
    const linhas = carrinho.map(i => `${i.qtd}x ${i.titulo} — ${fmt.format(i.preco)}`).join('\n');
    const total = fmt.format(carrinho.reduce((s,i)=>s+i.preco*i.qtd,0));
    const msg = `Olá! Quero finalizar a compra:%0A%0A${encodeURIComponent(linhas)}%0A%0ATotal: ${encodeURIComponent(total)}%0AForma de pagamento: ${encodeURIComponent(formaPagamento)}`;
    window.open(`https://wa.me/${numeroWA}?text=${msg}`, '_blank');
  }
  $('#finalizar').onclick = checkout;
  $('#cartCheckout').onclick = checkout;

  /* ===== Modal de Descrição ===== */
  const descModal = $('#descModal');
  const descTitle = $('#descTitle');
  const descBody  = $('#descBody');
  const descAdd   = $('#descAdd');
  const descWa    = $('#descWa');
  $('#descClose').onclick = () => closeDesc();
  descModal.addEventListener('click', (e)=>{ if(e.target===descModal) closeDesc(); });

  function openDesc(p){
    lastOpenedProd = p;
    descTitle.textContent = p.titulo || 'Produto';
    descBody.textContent = p.descricao || 'Sem descrição.';
    descModal.classList.add('show');
    document.body.style.overflow = 'hidden';
  }
  function closeDesc(){
    descModal.classList.remove('show');
    document.body.style.overflow = '';
  }
  descAdd.onclick = () => { if(lastOpenedProd){ addCarrinho(lastOpenedProd); closeDesc(); openCart(); } };
  descWa.onclick  = () => {
    if(!lastOpenedProd) return;
    const titulo = encodeURIComponent(lastOpenedProd.titulo || 'Produto');
    const preco  = fmt.format(Number(lastOpenedProd.preco||0));
    const msg = `Olá! Tenho interesse em: ${titulo}%0APreço: ${encodeURIComponent(preco)}`;
    window.open(`https://wa.me/${numeroWA}?text=${msg}`, '_blank');
  };

  /* ===== ADM ===== */
  document.getElementById('btnAdm').addEventListener('click', () => {
    if (sessionStorage.getItem('adm_ok') === '1') {
      location.href = 'admin-offline.html';
      return;
    }
    const pwd = prompt('Senha do administrador:');
    if (pwd == null) return;
    if (pwd === "PEDRO1503") {
      sessionStorage.setItem('adm_ok','1');
      location.href = 'admin-offline.html';
    } else {
      alert('Senha incorreta.');
    }
  });

  // start
  renderGrid();
</script>
</body>
</html>
